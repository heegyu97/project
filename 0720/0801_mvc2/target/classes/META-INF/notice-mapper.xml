<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="NoticeMapper">

	<delete id="delete" parameterType="java.lang.String">
	delete from notice  
	where noti_no = #{noti_no} 
	</delete>


	<update id="update" parameterType="kr.co.ictedu.util.dto.NoticeDTO">
	update notice set noti_title=#{noti_title}, noti_ctnts=#{noti_ctnts}  
		<if test="noti_pic != null and noti_pic != ''">
			, noti_pic = #{noti_pic}
			, noti_path = #{noti_path}
		</if> 
	where noti_no = #{noti_no}
	</update>


	<update id="fileDelete" parameterType="kr.co.ictedu.util.dto.NoticeDTO">
	update notice 
		<if test= "noti_pic != null and noti_pic != ''">
			set noti_pic='' 
			, noti_path ='' 
		</if>
		where noti_no = #{noti_no}
	</update>
	
	
	

	<update id="incrementViewCnt" parameterType="java.lang.String">
	update notice set noti_view_cnt = noti_view_cnt + 1 
	where noti_no = #{noti_no}
	</update>


	<select id="detail" parameterType="java.lang.String" resultType="kr.co.ictedu.util.dto.NoticeDTO">
	select m.m_no,  m.m_id, n.noti_no, n.noti_title, n.noti_ctnts, n.noti_date, n.noti_view_cnt, n.noti_pic, n.noti_path  
	from notice n , member m 
	where noti_no = #{noti_no}
	and n.m_no = m.m_no 
	</select>




	<select id="searchList" parameterType="kr.co.ictedu.util.dto.SearchDTO" 
			resultType="kr.co.ictedu.util.dto.NoticeDTO">
	select noti_no, noti_title, noti_ctnts, noti_date, noti_pic, noti_path, noti_view_cnt  
	from notice 
	<if test="searchOption !=null and searchOption !='' 
				and searchWord != null and searchWord !='' ">
		<choose>
			<when test="searchOption == 'noti_title' ">
			where noti_title like concat('%', #{searchWord}, '%')
			</when>
			<when test="searchOption == 'noti_no' ">
			where noti_no like concat('%', #{searchWord}, '%')
			</when>
		</choose>			
	</if> 
	order by noti_no desc 
	limit #{limitNum}, 10
	</select>


	<select id="searchListCount" parameterType="kr.co.ictedu.util.dto.SearchDTO"
			 resultType="int">
	select count(noti_no) cnt from notice 
	<if test="searchOption != null and searchOption !='' 
				and searchWord != null and searchWord != '' ">
		<choose>
			<when test="searchOption == 'noti_title'">
			where noti_title like concat('%',#{searchWord}, '%')
			</when>
			<when test="searchOption == 'noti_no'">
			where noti_no like concat('%',#{searchWord}, '%')
			</when>
		</choose>
	</if>
	</select>
	

	<insert id="write" parameterType="kr.co.ictedu.util.dto.NoticeDTO">
	insert into notice (noti_no, noti_title, noti_ctnts, noti_date, noti_pic, noti_path, m_no ) 
	values (0, #{noti_title}, #{noti_ctnts},  now(), #{noti_pic}, #{noti_path}, #{m_no})
	</insert>
	
	


</mapper>
