<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="GusetMapper">
		
		<update id="incrementViewCnt" parameterType="java.lang.String">
			update product
			set pro_view_cnt = pro_view_cnt + 1
			where pro_no = #{pro_no}
		</update>
		
		<select id="detail" parameterType="java.lang.String" resultType="kr.co.ictedu.util.dto.ProductDTO">
			select pro_no, pro_big, pro_mid, pro_age, pro_name, pro_date, pro_stock, pro_price, 
				pro_dc, pro_dc_strt, pro_dc_end, pro_ship, pro_ship_free, pro_thum_pic, 
				pro_thum_path, pro_prdt_pic, pro_prdt_path, pro_ctnts, pro_view_cnt
			from product
			where pro_no = #{pro_no}
			
		</select>
		
		<select id="selectList"  parameterType="kr.co.ictedu.util.dto.SearchDTO"
									resultType="kr.co.ictedu.util.dto.ProductDTO">
			select pro_no, pro_big, pro_mid, pro_age, pro_name, pro_date, pro_stock, pro_price, 
				pro_dc, pro_dc_strt, pro_dc_end, pro_ship, pro_ship_free, pro_thum_pic, 
				pro_thum_path, pro_prdt_pic, pro_prdt_path, pro_ctnts, pro_view_cnt
			from product
			<!-- K대분류 조건 -->
			<if test="searchOption != null and searchOption != ''">
				where pro_big = #{searchOption}
			</if>
			<!-- K중분류조건 -->
			<if test="searchOption2 != null and searchOption2 != ''">
				and pro_mid = #{searchOption2}
			</if>
			
			<!-- S상품명조건 -->
			<if test="searchWord != null and searchWord !=''">
				where pro_name like concat('%', #{searchWord}, '%')
			</if>
			
			<!-- 
			최신
			판매량  => 현재불가 
			리뷰 => 조회수로 변경
			높은 가격
			낮은 가격
			높은 할인율
			 -->
			order by 
			<!-- 정렬조건 -->
			<if test="searchOption3 != null and searchOption3 != ''">
				<choose>
					<when test = "searchOption3 == 'recency'">
						pro_date desc, 
					</when>
					<when test = "searchOption3 == 'sales'">
						
					</when>
					<when test = "searchOption3 == 'look'">
						pro_view_cnt desc,	
					</when>
					<when test = "searchOption3 == 'hprice'">
						pro_price -  pro_price * pro_dc / 100  desc , 
					</when>
					<when test = "searchOption3 == 'lprice'">
						pro_price -  pro_price * pro_dc / 100 ,
					</when>
					<when test =  "searchOption3 == 'hdis'">
						pro_dc desc,
					</when>
					<when test = "searchOption3 == 'ldis'">
						pro_dc  , 
					</when>
				</choose>
			</if>
			pro_no desc
			limit #{limitNum}, 10
		</select>
		
		<select id="searchListCount" parameterType="kr.co.ictedu.util.dto.SearchDTO" resultType="int">
			select count(pro_no) cnt from product
			<!-- 대분류 조건 -->
			<if test="searchOption != null and searchOption != ''">
				where pro_big = #{searchOption}
			</if>
			<!-- 중분류조건 -->
			<if test="searchOption2 != null and searchOption2 != ''">
				and pro_mid = #{searchOption2}
			</if>
			<!-- 상품명조건 -->
			<if test="searchWord != null and searchWord !=''">
				where pro_name like concat('%', #{searchWord}, '%')
			</if>
		</select>

		
		
		
		<delete id="deleteid" parameterType="kr.co.ictedu.util.dto.MemberDTO">
			delete from member where m_no = #{m_no} and m_pwd = #{m_pwd}
		</delete>

		<update id="updateid" parameterType="kr.co.ictedu.util.dto.MemberDTO">
			update member set 
			m_pwd = #{m_pwd}, m_tel = #{m_tel}, m_email = #{m_email}, 
			m_sms_agree = #{m_sms_agree},m_email_agree = #{m_email_agree}, m_post = #{m_post}, 
			m_addr1 = #{m_addr1}, m_addr2 = #{m_addr2},	m_cat_age = #{m_cat_age}, 
			m_cat_sex = #{m_cat_sex}, m_neut_yn = #{m_neut_yn}
			where m_no = #{m_no}
		</update>


	<select id="bigSelect"  resultType="kr.co.ictedu.util.dto.CommenCodeDTO">
		select distinct( code_class )
		from commen_code 
	</select>
	
	<select id="midSelect" parameterType="java.lang.String" resultType="kr.co.ictedu.util.dto.CommenCodeDTO">
		SELECT code_name ,code_class, code_no 
		FROM commen_code 
		where code_class = #{select_pro_big}
		
	</select>

</mapper>
